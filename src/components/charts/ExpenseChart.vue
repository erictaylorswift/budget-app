<template>
    <div class="half"> 
        <h2>Daily Expenses</h2>
        <bar-chart :chart-data="datacollection" :options="chartOptions" width="50" height="25"></bar-chart>
    </div>
</template>

<script>
import { mapState } from 'vuex'
import moment from 'moment'
import BarChart from './Bar.js'
export default {
    created() {
        this.$store.dispatch('fetchDailyExpenses')
        this.fillData()
    },
    computed: {
        ...mapState(['dailyExpenses']),

    },
    components: { BarChart },
    data() {
        return {
            chart: false,
            datacollection: null,
            chartOptions: {
                layout: {
                    padding: {
                        left: 0,
                        right: 100,
                        top: 60,
                        bottom: 60
                    }
                },
                responsive: true,
                maintainAspectRation: false,
                categoryPercentage: 1.0,
                barPercentage: 1.0,
                legend: {
                    display: false,
                },
                title: {
                    display: false,
                    text: 'Daily Expenses'
                },
                scales: {
                    yAxes: [{
                        ticks: {
                            callback: function(value, index, values) {
                                return '$' + value;
                            }
                        }
                    }]
                },
                tooltips: {
                    callbacks: {
                        label: function(tooltipItem, data) {
                            var dataLabel = data.datasets[tooltipItem.datasetIndex].label;
                            return dataLabel + ': $' + tooltipItem.yLabel
                        }
                    }
                }
            }
        }
    },
    methods: {
        fillData() {
            this.chart = true
            let state = this.$store.state.dailyExpenses;
            let dates = []
            let amounts = []

            state.forEach(doc => {
                dates.push(moment(doc.date).format("MMM Do"))
                amounts.push(parseFloat(doc.amount).toFixed(2))
            })

            this.datacollection = {
                labels: dates,
                datasets: [
                    {
                        label: 'Daily Expenses',
                        data: amounts,
                        backgroundColor: '#41A234',
                        hoverBackgroundColor: '#2D6F24'
                    }
                ]
            }
        }
    }
}
</script>

